<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Neela & Papa - Tamagotchi</title>
  <style>
    body {
      margin: 0;
      background: url('fond-stitch.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Comic Sans MS', cursive;
      overflow-x: hidden;
    }

    #fond-stitch {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 120px;
      cursor: pointer;
      z-index: 100;
    }

    .container {
      margin-top: 180px;
      text-align: center;
    }

    #stitch-gif {
      width: 200px;
      height: auto;
      margin-bottom: 20px;
    }

    .button-row {
      margin-top: 20px;
    }

    .button-row button {
      background: none;
      border: none;
      font-size: 30px;
      margin: 10px;
      cursor: pointer;
    }

    .jauges {
      display: flex;
      justify-content: space-around;
      margin: 50px auto 0;
      width: 90%;
      max-width: 500px;
      flex-wrap: wrap;
    }

    .jauge {
      position: relative;
      width: 80px;
      height: 150px;
      background: url('coquillage.png') no-repeat center center;
      background-size: contain;
      margin: 10px;
    }

    .jauge-inner {
      position: absolute;
      bottom: 20%;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      background: #fffacd;
      border-radius: 10px;
      transition: height 0.3s;
    }

    @keyframes gifFade {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>

<div id="fond-stitch"></div>

<div class="container">
  <img id="stitch-gif" src="stitch5.gif" alt="Stitch">

  <div class="button-row">
    <button onclick="handleAction('eat')">üçç</button>
    <button onclick="handleAction('play')">üèÑ</button>
    <button onclick="handleAction('bath')">üöø</button>
    <button onclick="handleAction('sleep')">üò¥</button>
  </div>

  <div class="jauges">
    <div class="jauge"><div id="jauge-eat" class="jauge-inner"></div></div>
    <div class="jauge"><div id="jauge-play" class="jauge-inner"></div></div>
    <div class="jauge"><div id="jauge-bath" class="jauge-inner"></div></div>
    <div class="jauge"><div id="jauge-sleep" class="jauge-inner"></div></div>
  </div>
</div>

<script>
  let jauges = {
    eat: 1000,
    play: 1000,
    bath: 1000,
    sleep: 1000
  };

  const gifs = {
    eat: ["stitch16.gif"],
    play: ["stitch7.gif", "stitch9.gif", "stitch13.gif", "stitch14.gif", "stitch15.gif"],
    bath: ["stitch18.gif", "stitch19.gif"],
    sleep: [["stitch2.gif", "stitch3.gif", "stitch20.gif"], ["stitch2.gif", "stitch3.gif", "stitch21.gif"], ["stitch2.gif", "stitch3.gif", "stitch22.gif"]]
  };

  const states = {
    normal: "stitch5.gif",
    tired: "stitch12.gif",
    angry: "stitch17.gif",
    sad: "stitch1.gif",
    cold: ["stitch10.gif", "stitch11.gif"]
  };

  function updateJauges() {
    for (let key in jauges) {
      let value = Math.max(0, Math.min(1000, jauges[key]));
      document.getElementById("jauge-" + key).style.height = (value / 10) + "%";
    }
    localStorage.setItem("jauges", JSON.stringify(jauges));
  }

  function loadJauges() {
    let saved = localStorage.getItem("jauges");
    if (saved) {
      jauges = JSON.parse(saved);
    }
    updateJauges();
  }

  function random(array) {
    return array[Math.floor(Math.random() * array.length)];
  }

  function playGifSequence(sequence, callback) {
    const stitch = document.getElementById("stitch-gif");
    let i = 0;

    function next() {
      if (i < sequence.length) {
        stitch.src = sequence[i];
        i++;
        setTimeout(next, 2000);
      } else {
        callback();
      }
    }

    next();
  }

  function handleAction(type) {
    if (type === 'sleep') {
      playGifSequence(random(gifs.sleep), () => {
        jauges.sleep = 1000;
        updateMood();
        updateJauges();
      });
    } else {
      const gif = random(gifs[type]);
      document.getElementById("stitch-gif").src = gif;
      setTimeout(() => {
        jauges[type] = 1000;
        updateMood();
        updateJauges();
      }, 3000);
    }
  }

  function updateMood() {
    const stitch = document.getElementById("stitch-gif");
    if (jauges.eat < 300) {
      stitch.src = states.sad;
    } else if (jauges.play < 300) {
      stitch.src = states.angry;
    } else if (jauges.sleep < 300) {
      stitch.src = states.tired;
    } else if (jauges.bath < 300 && Math.random() < 0.4) {
      stitch.src = random(states.cold);
    } else {
      stitch.src = states.normal;
    }
  }

  setInterval(() => {
    for (let key in jauges) {
      jauges[key] -= 5;
      if (jauges[key] < 0) jauges[key] = 0;
    }
    updateMood();
    updateJauges();
  }, 3000);

  document.getElementById("fond-stitch").addEventListener("click", () => {
    const stitch = document.getElementById("stitch-gif");
    stitch.src = "stitch24.gif";
    setTimeout(() => {
      window.location.href = "index.html";
    }, 1800);
  });

  loadJauges();
</script>

</body>
</html>
