<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tamagotchi Stitch</title>
  <style>
    body {
      margin: 0;
      background: url('fond-stitch.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Comic Sans MS', cursive;
      overflow-x: hidden;
      color: white;
    }

    .container {
      text-align: center;
      padding-top: 6cm;
    }

    #stitch {
      width: 200px;
      height: auto;
      margin: auto;
      display: block;
    }

    .buttons {
      margin-top: 20px;
    }

    .buttons button {
      margin: 10px;
      font-size: 24px;
      padding: 10px;
      border-radius: 50%;
      border: none;
      background: #ffffffaa;
      cursor: pointer;
    }

    .gauges {
      display: flex;
      justify-content: center;
      margin-top: 40px;
      gap: 30px;
    }

    .gauge {
      width: 60px;
      height: 200px;
      background: url('coquillage.png') no-repeat center/contain;
      position: relative;
    }

    .gauge-fill {
      position: absolute;
      bottom: 20px;
      left: 25%;
      width: 50%;
      background: yellow;
      transition: height 0.5s;
      border-radius: 20px;
    }

    .night {
      filter: brightness(0.4);
    }
  </style>
</head>
<body>
  <div class="container">
    <img id="stitch" src="stitch5.gif" alt="Stitch">

    <div class="buttons">
      <button onclick="playAction('eat')">üçç</button>
      <button onclick="playAction('play')">üèÑ</button>
      <button onclick="playAction('wash')">üöø</button>
      <button onclick="playAction('sleep')">üò¥</button>
    </div>

    <div class="gauges">
      <div class="gauge"><div class="gauge-fill" id="g1" style="height:100%; background: yellow;"></div></div>
      <div class="gauge"><div class="gauge-fill" id="g2" style="height:100%; background: lightblue;"></div></div>
      <div class="gauge"><div class="gauge-fill" id="g3" style="height:100%; background: pink;"></div></div>
      <div class="gauge"><div class="gauge-fill" id="g4" style="height:100%; background: orange;"></div></div>
    </div>
  </div>

  <script>
    let stitch = document.getElementById('stitch');
    let gifs = {
      eat: "stitch16.gif",
      play: ["stitch7.gif", "stitch9.gif", "stitch13.gif", "stitch14.gif", "stitch15.gif"],
      wash: "stitch18.gif",
      sleep: ["stitch2.gif", "stitch3.gif", "stitch20.gif", "stitch21.gif", "stitch22.gif"]
    };

    let moods = {
      tired: "stitch12.gif",
      sad: "stitch1.gif",
      cold: ["stitch10.gif", "stitch11.gif"],
      angry: "stitch17.gif"
    };

    let gauges = [100, 100, 100, 100]; // eat, play, sleep, wash
    const fillEls = [g1, g2, g3, g4];
    let gaugeNames = ['eat', 'play', 'sleep', 'wash'];

    // Jour/Nuit auto
    const hour = new Date().getHours();
    if (hour < 7 || hour > 20) document.body.classList.add("night");

    function updateGauges() {
      for (let i = 0; i < gauges.length; i++) {
        fillEls[i].style.height = gauges[i] + "%";
      }
    }

    function saveGauges() {
      localStorage.setItem("gauges", JSON.stringify(gauges));
    }

    function loadGauges() {
      let saved = localStorage.getItem("gauges");
      if (saved) gauges = JSON.parse(saved);
      updateGauges();
    }

    function autoDecrease() {
      gauges = gauges.map(g => Math.max(0, g - 1));
      updateGauges();
      saveGauges();
      checkMood();
    }

    function checkMood() {
      if (gauges[2] < 30) stitch.src = moods.tired;
      else if (gauges[0] < 30) stitch.src = moods.sad;
      else if (gauges[3] < 30) stitch.src = moods.angry;
      else if (Math.random() < 0.05) stitch.src = moods.cold[Math.floor(Math.random() * 2)];
      else stitch.src = "stitch5.gif";
    }

    function playAction(type) {
      let gif;
      if (Array.isArray(gifs[type])) {
        gif = gifs[type][Math.floor(Math.random() * gifs[type].length)];
      } else {
        gif = gifs[type];
      }

      switch (type) {
        case "eat": gauges[0] = Math.min(100, gauges[0] + 20); break;
        case "play": gauges[1] = Math.min(100, gauges[1] + 20); break;
        case "sleep": gauges[2] = Math.min(100, gauges[2] + 20); break;
        case "wash": gauges[3] = Math.min(100, gauges[3] + 20); break;
      }

      updateGauges();
      saveGauges();

      stitch.src = gif;
      setTimeout(() => {
        checkMood();
      }, 4000);
    }

    loadGauges();
    updateGauges();
    setInterval(autoDecrease, 10000); // toutes les 10s
  </script>
</body>
</html>
