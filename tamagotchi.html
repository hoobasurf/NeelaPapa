<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tamagotchi Stitch</title>
  <style>
    body {
      margin: 0;
      background: url('fond-stitch.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Comic Sans MS', cursive;
      overflow-x: hidden;
      color: white;
    }

    .container {
      text-align: center;
      padding-top: 6cm;
    }

    #stitch {
      width: 200px;
      height: auto;
      margin: auto;
      display: block;
    }

    .buttons {
      margin-top: 20px;
    }

    .buttons button {
      margin: 10px;
      font-size: 24px;
      padding: 10px;
      border-radius: 50%;
      border: none;
      background: #ffffffaa;
      cursor: pointer;
    }

    .gauges {
      display: flex;
      justify-content: center;
      margin-top: 40px;
      gap: 30px;
    }

    .gauge {
      width: 60px;
      height: 200px;
      background: url('coquillage.png') no-repeat center/contain;
      position: relative;
    }

    .gauge-fill {
      position: absolute;
      bottom: 20px;
      left: 25%;
      width: 50%;
      background: yellow;
      transition: height 0.5s;
      border-radius: 20px;
    }

    .night {
      filter: brightness(0.4);
    }
  </style>
</head>
<body>
  <div class="container">
    <img id="stitch" src="stitch5.gif" alt="Stitch">

    <div class="buttons">
      <button onclick="playAction('eat')">üçç</button>
      <button onclick="playAction('play')">üèÑ</button>
      <button onclick="playAction('wash')">üöø</button>
      <button onclick="playAction('sleep')">üò¥</button>
    </div>

    <div class="gauges">
      <div class="gauge"><div class="gauge-fill" id="g1" style="background: pink;"></div></div>
      <div class="gauge"><div class="gauge-fill" id="g2" style="background: lightgreen;"></div></div>
      <div class="gauge"><div class="gauge-fill" id="g3" style="background: lightblue;"></div></div>
      <div class="gauge"><div class="gauge-fill" id="g4" style="background: orange;"></div></div>
    </div>
  </div>

  <script>
    const stitch = document.getElementById('stitch');
    const fillEls = [g1, g2, g3, g4];
    const gaugeKeys = ['eat', 'play', 'sleep', 'wash'];
    let gauges = [70, 70, 70, 70]; // Initial values

    // Charger depuis localStorage
    window.onload = () => {
      for (let i = 0; i < 4; i++) {
        const saved = localStorage.getItem('gauge-' + gaugeKeys[i]);
        if (saved !== null) gauges[i] = parseInt(saved);
      }
      updateGauges();
      updateMood();
    };

    const gifs = {
      eat: ['stitch16.gif'],
      play: ['stitch7.gif', 'stitch9.gif', 'stitch13.gif', 'stitch14.gif', 'stitch15.gif'],
      wash: ['stitch18.gif', 'stitch19.gif'],
      sleep: ['stitch2.gif', 'stitch3.gif', 'stitch20.gif', 'stitch21.gif', 'stitch22.gif']
    };

    const moods = {
      tired: 'stitch12.gif',
      sad: 'stitch1.gif',
      cold: ['stitch10.gif', 'stitch11.gif'],
      angry: 'stitch17.gif',
      normal: 'stitch5.gif'
    };

    function updateGauges() {
      for (let i = 0; i < 4; i++) {
        fillEls[i].style.height = `${Math.min(100, Math.max(0, gauges[i]))}%`;
        localStorage.setItem('gauge-' + gaugeKeys[i], gauges[i]);
      }
    }

    function updateMood() {
      const [eat, play, sleep, wash] = gauges;

      if (sleep < 30 && wash < 30) {
        stitch.src = moods.cold[Math.floor(Math.random() * moods.cold.length)];
      } else if (sleep < 30) {
        stitch.src = moods.tired;
      } else if (play < 30) {
        stitch.src = moods.angry;
      } else if (eat < 30) {
        stitch.src = moods.sad;
      } else {
        stitch.src = moods.normal;
      }
    }

    function playAction(type) {
      const index = gaugeKeys.indexOf(type);
      if (index === -1) return;

      // Incr√©menter la jauge
      gauges[index] = Math.min(100, gauges[index] + 20);
      updateGauges();

      // Choisir GIF
      const gifList = gifs[type];
      const chosenGif = gifList[Math.floor(Math.random() * gifList.length)];
      stitch.src = chosenGif;

      // Retour √† l‚Äôhumeur apr√®s 6s
      setTimeout(() => updateMood(), 6000);
    }

    // D√©cr√©mentation auto toutes les 20s
    setInterval(() => {
      for (let i = 0; i < 4; i++) {
        gauges[i] = Math.max(0, gauges[i] - 2);
      }
      updateGauges();
      updateMood();
    }, 20000);

    // Mode nuit
    const hour = new Date().getHours();
    if (hour < 7 || hour > 20) document.body.classList.add("night");
  </script>
</body>
</html>
