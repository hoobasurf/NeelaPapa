<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tamagotchi - Neela & Papa</title>
  <style>
    body {
      margin: 0;
      background: url('fond-stitch.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Comic Sans MS', cursive;
      color: white;
      overflow-x: hidden;
    }

    #stitch {
      display: block;
      margin: 5cm auto 20px auto;
      height: 200px;
      transition: opacity 0.3s ease-in-out;
    }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .buttons button {
      background: pink;
      border: none;
      border-radius: 50%;
      padding: 15px;
      font-size: 24px;
      cursor: pointer;
    }

    .gauges {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 40px;
    }

    .gauge {
      position: relative;
      width: 60px;
      height: 200px;
      background: url('coquillage.png') no-repeat center/contain;
    }

    .fill {
      position: absolute;
      bottom: 10px;
      left: 15px;
      width: 30px;
      background-color: #00ffffaa;
      border-radius: 10px;
      transition: height 0.5s;
    }

    .night {
      filter: brightness(0.5);
    }
  </style>
</head>
<body>

  <img id="stitch" src="stitch5.jpg" alt="Stitch" />

  <div class="buttons">
    <button onclick="playAction('eat')">üçç</button>
    <button onclick="playAction('play')">üèÑ</button>
    <button onclick="playAction('bath')">üöø</button>
    <button onclick="playAction('sleep')">üò¥</button>
  </div>

  <div class="gauges">
    <div class="gauge" id="energyGauge"><div class="fill" id="energyFill"></div></div>
    <div class="gauge" id="funGauge"><div class="fill" id="funFill"></div></div>
    <div class="gauge" id="cleanGauge"><div class="fill" id="cleanFill"></div></div>
  </div>

<script>
  const stitch = document.getElementById('stitch');
  const gifMap = {
    eat: ['stitch16.gif'],
    play: ['stitch7.gif', 'stitch9.gif', 'stitch13.gif', 'stitch14.gif', 'stitch15.gif'],
    bath: ['stitch18.gif', 'stitch19.gif'],
    sleep: [['stitch2.gif', 'stitch3.gif', 'stitch20.gif'], ['stitch2.gif', 'stitch3.gif', 'stitch21.gif'], ['stitch2.gif', 'stitch3.gif', 'stitch22.gif']],
  };

  let gauges = {
    energy: parseFloat(localStorage.getItem('energy')) || 100,
    fun: parseFloat(localStorage.getItem('fun')) || 100,
    clean: parseFloat(localStorage.getItem('clean')) || 100,
  };

  function updateGauges() {
    document.getElementById('energyFill').style.height = gauges.energy + '%';
    document.getElementById('funFill').style.height = gauges.fun + '%';
    document.getElementById('cleanFill').style.height = gauges.clean + '%';

    localStorage.setItem('energy', gauges.energy);
    localStorage.setItem('fun', gauges.fun);
    localStorage.setItem('clean', gauges.clean);

    updateMood();
  }

  function playAction(type) {
    let sequence = gifMap[type];
    if (type === 'sleep') {
      sequence = sequence[Math.floor(Math.random() * sequence.length)];
    }
    if (!Array.isArray(sequence)) sequence = [sequence];

    let index = 0;

    function playNext() {
      if (index < sequence.length) {
        stitch.src = sequence[index];
        index++;
        setTimeout(playNext, 1000);
      } else {
        stitch.src = 'stitch5.jpg';
      }
    }

    playNext();

    // Refill logic
    if (type === 'eat') gauges.energy = Math.min(100, gauges.energy + 25);
    if (type === 'play') gauges.fun = Math.min(100, gauges.fun + 25);
    if (type === 'bath') gauges.clean = Math.min(100, gauges.clean + 25);
    if (type === 'sleep') gauges.energy = Math.min(100, gauges.energy + 50);

    updateGauges();
  }

  function updateMood() {
    if (gauges.energy < 20 || gauges.fun < 20 || gauges.clean < 20) {
      stitch.src = 'stitch1.gif'; // triste
    } else if (gauges.energy < 40 && gauges.fun < 40) {
      stitch.src = 'stitch17.gif'; // √©nerv√©
    }
  }

  function autoDecrease() {
    gauges.energy = Math.max(0, gauges.energy - 0.1);
    gauges.fun = Math.max(0, gauges.fun - 0.05);
    gauges.clean = Math.max(0, gauges.clean - 0.08);
    updateGauges();
  }

  setInterval(autoDecrease, 1000);

  // Jour/Nuit
  const hour = new Date().getHours();
  if (hour < 7 || hour > 19) {
    document.body.classList.add('night');
  }

  updateGauges();
</script>

</body>
</html>
