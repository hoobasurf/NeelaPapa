<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tamagotchi</title>
  <style>
    body {
      margin: 0;
      background: url('fond-stitch.jpg') no-repeat center center/cover;
      font-family: Arial, sans-serif;
      overflow-x: hidden;
    }

    #gif-container {
      text-align: center;
      margin-top: 6cm;
    }

    #stitch-gif {
      width: 200px;
      max-width: 80%;
      height: auto;
    }

    .buttons {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 20px;
    }

    .buttons button {
      font-size: 24px;
      border: none;
      background: none;
      cursor: pointer;
    }

    .jauges {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .jauge {
      width: 60px;
      height: 150px;
      background: url('coquillage.png') no-repeat center center/contain;
      position: relative;
    }

    .niveau {
      position: absolute;
      bottom: 5px;
      left: 0;
      width: 100%;
      background: rgba(0, 200, 255, 0.6);
      transition: height 0.5s ease;
    }

    #fond-stitch {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 120px;
      z-index: 2;
    }

    #fond-stitch:hover {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="fond-stitch" onclick="handleTitleClick()"></div>

  <div id="gif-container">
    <img id="stitch-gif" src="stitch5.gif" alt="Stitch" />
  </div>

  <div class="buttons">
    <button onclick="jouer()">üèÑ</button>
    <button onclick="manger()">üçç</button>
    <button onclick="dormir()">üò¥</button>
    <button onclick="laver()">üöø</button>
  </div>

  <div class="jauges">
    <div class="jauge"><div id="jauge-jeu" class="niveau" style="height: 100%;"></div></div>
    <div class="jauge"><div id="jauge-nourriture" class="niveau" style="height: 100%;"></div></div>
    <div class="jauge"><div id="jauge-dodo" class="niveau" style="height: 100%;"></div></div>
    <div class="jauge"><div id="jauge-bain" class="niveau" style="height: 100%;"></div></div>
  </div>

  <script>
    const stitch = document.getElementById("stitch-gif");

    let gifNormal = "stitch5.gif";
    let humeurActuelle = "normal";

    const gifs = {
      jouer: ["stitch7.gif", "stitch9.gif", "stitch13.gif", "stitch14.gif", "stitch15.gif"],
      manger: ["stitch16.gif"],
      dormir: [["stitch2.gif", "stitch3.gif", "stitch20.gif"], ["stitch2.gif", "stitch3.gif", "stitch21.gif"], ["stitch2.gif", "stitch3.gif", "stitch22.gif"]],
      laver: ["stitch18.gif", "stitch19.gif"]
    };

    const jauges = {
      jeu: document.getElementById("jauge-jeu"),
      nourriture: document.getElementById("jauge-nourriture"),
      dodo: document.getElementById("jauge-dodo"),
      bain: document.getElementById("jauge-bain")
    };

    const niveaux = {
      jeu: 1000,
      nourriture: 1000,
      dodo: 1000,
      bain: 1000
    };

    function updateJauges() {
      for (let key in jauges) {
        jauges[key].style.height = niveaux[key] / 10 + "%";
      }
    }

    function changerGif(tempGif, callback) {
      stitch.src = tempGif;
      stitch.onload = () => {
        setTimeout(() => {
          majHumeur();
          callback && callback();
        }, 4000); // attend fin du gif
      };
    }

    function jouer() {
      niveaux.jeu = Math.min(niveaux.jeu + 200, 1000);
      let gif = gifs.jouer[Math.floor(Math.random() * gifs.jouer.length)];
      changerGif(gif);
      updateJauges();
    }

    function manger() {
      niveaux.nourriture = Math.min(niveaux.nourriture + 200, 1000);
      changerGif(gifs.manger[0]);
      updateJauges();
    }

    function dormir() {
      niveaux.dodo = Math.min(niveaux.dodo + 300, 1000);
      let sequence = gifs.dormir[Math.floor(Math.random() * gifs.dormir.length)];
      jouerSequence(sequence);
      updateJauges();
    }

    function laver() {
      niveaux.bain = Math.min(niveaux.bain + 300, 1000);
      let gif = gifs.laver[Math.floor(Math.random() * gifs.laver.length)];
      changerGif(gif);
      updateJauges();
    }

    function jouerSequence(gifList, index = 0) {
      if (index >= gifList.length) {
        majHumeur();
        return;
      }
      stitch.src = gifList[index];
      stitch.onload = () => {
        setTimeout(() => {
          jouerSequence(gifList, index + 1);
        }, 2000);
      };
    }

    function baisseAuto() {
      for (let key in niveaux) {
        niveaux[key] = Math.max(niveaux[key] - 20, 0);
      }
      updateJauges();
      majHumeur();
    }

    function majHumeur() {
      if (niveaux.jeu < 300) {
        stitch.src = "stitch17.gif"; // √ânerv√©
      } else if (niveaux.dodo < 300) {
        stitch.src = "stitch12.gif"; // Fatigu√©
      } else if (niveaux.bain < 300) {
        stitch.src = "stitch10.gif"; // Froid
      } else if (niveaux.nourriture < 300) {
        stitch.src = "stitch1.gif"; // Triste
      } else {
        stitch.src = gifNormal; // Normal
      }
    }

    // Baisse auto toutes les 15s
    setInterval(baisseAuto, 15000);
    updateJauges();

    // Sauvegarde
    window.addEventListener("beforeunload", () => {
      localStorage.setItem("jauges", JSON.stringify(niveaux));
    });

    window.addEventListener("load", () => {
      let saved = localStorage.getItem("jauges");
      if (saved) {
        Object.assign(niveaux, JSON.parse(saved));
        updateJauges();
        majHumeur();
      }
    });

    function handleTitleClick() {
      // Aller/retour entre les pages
      const current = window.location.pathname;
      if (current.includes("tamagotchi")) {
        // retour
        const gif = document.createElement("img");
        gif.src = "stitch24.gif";
        gif.style.position = "fixed";
        gif.style.top = "0";
        gif.style.left = "0";
        gif.style.width = "100%";
        gif.style.zIndex = 9999;
        document.body.appendChild(gif);
        setTimeout(() => {
          window.location.href = "index.html";
        }, 2500);
      } else {
        // aller
        const gif = document.createElement("img");
        gif.src = "stitch25.gif";
        gif.style.position = "fixed";
        gif.style.top = "0";
        gif.style.left = "0";
        gif.style.width = "100%";
        gif.style.zIndex = 9999;
        document.body.appendChild(gif);
        setTimeout(() => {
          window.location.href = "tamagotchi.html";
        }, 2500);
      }
    }
  </script>
</body>
</html>
