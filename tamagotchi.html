<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Neela & Papa - Tamagotchi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      background: url('fond-stitch.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Comic Sans MS', cursive;
      text-align: center;
      color: white;
    }

    .fond-stitch {
      font-size: 36px;
      margin: 20px 0;
      cursor: pointer;
      text-shadow: 0 0 8px #ff8de3, 0 0 15px #ffd6f9;
      transition: transform 0.3s ease, text-shadow 0.3s ease;
    }

    .fond-stitch:hover {
      transform: scale(1.1);
      text-shadow: 0 0 15px #ff63c3, 0 0 25px #ffd6f9, 0 0 35px #fff0f8;
    }

    #stitch-container {
      margin-top: 6cm;
    }

    #stitch-gif {
      width: 180px;
      height: auto;
      margin-bottom: 20px;
    }

    .btn-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
    }

    .tama-btn {
      font-size: 20px;
      padding: 10px;
      border-radius: 12px;
      background: #ffb6f9;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #ff77d4;
      transition: 0.3s;
    }

    .tama-btn:hover {
      transform: scale(1.05);
      background: #ff91f2;
    }

    .gauges {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .gauge {
      position: relative;
      width: 70px;
      height: 120px;
      background: url('coquillage.png') no-repeat center center;
      background-size: contain;
    }

    .fill {
      position: absolute;
      bottom: 15%;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 0;
      background-color: #00f0ff;
      border-radius: 10px;
      transition: height 0.3s ease;
    }
  </style>
</head>
<body>

<h1 class="fond-stitch" onclick="togglePage()">Neela & Papa</h1>

<div id="stitch-container">
  <img id="stitch-gif" src="stitch5.gif" alt="Stitch normal">
</div>

<div class="btn-container">
  <button class="tama-btn" onclick="playGif('manger')">üçç</button>
  <button class="tama-btn" onclick="playGif('jouer')">üèÑ</button>
  <button class="tama-btn" onclick="playGif('dormir')">üò¥</button>
  <button class="tama-btn" onclick="playGif('douche')">üöø</button>
</div>

<div class="gauges">
  <div class="gauge"><div class="fill" id="gauge-manger"></div></div>
  <div class="gauge"><div class="fill" id="gauge-jouer"></div></div>
  <div class="gauge"><div class="fill" id="gauge-dormir"></div></div>
  <div class="gauge"><div class="fill" id="gauge-douche"></div></div>
</div>

<script>
  const stitchGif = document.getElementById("stitch-gif");

  const moods = {
    triste: "stitch1.gif",
    fatigue: "stitch2.gif",
    enerve: "stitch17.gif",
    froid: ["stitch10.gif", "stitch11.gif"],
    normal: "stitch5.gif"
  };

  const gifActions = {
    manger: ["stitch16.gif"],
    jouer: ["stitch7.gif", "stitch9.gif", "stitch13.gif", "stitch14.gif", "stitch15.gif"],
    dormir: ["stitch12.gif", "stitch20.gif", "stitch21.gif", "stitch22.gif"],
    douche: ["stitch18.gif", "stitch19.gif"]
  };

  const gauges = {
    manger: { el: document.getElementById("gauge-manger"), value: 1000 },
    jouer: { el: document.getElementById("gauge-jouer"), value: 1000 },
    dormir: { el: document.getElementById("gauge-dormir"), value: 1000 },
    douche: { el: document.getElementById("gauge-douche"), value: 1000 },
  };

  function updateGauges() {
    for (let key in gauges) {
      let percent = gauges[key].value / 10;
      gauges[key].el.style.height = percent + "%";
    }
  }

  function saveGauges() {
    localStorage.setItem("tamaGauges", JSON.stringify(
      Object.fromEntries(Object.entries(gauges).map(([k, v]) => [k, v.value]))
    ));
  }

  function loadGauges() {
    const saved = JSON.parse(localStorage.getItem("tamaGauges"));
    if (saved) {
      for (let key in gauges) {
        gauges[key].value = saved[key] || 1000;
      }
    }
    updateGauges();
  }

  function lowerGauges() {
    for (let key in gauges) {
      gauges[key].value = Math.max(0, gauges[key].value - 5);
    }
    updateGauges();
    updateMood();
    saveGauges();
  }

  function updateMood() {
    if (Object.values(gauges).some(g => g.value === 0)) {
      stitchGif.src = moods.triste;
    } else if (gauges.dormir.value < 300) {
      stitchGif.src = moods.fatigue;
    } else if (gauges.jouer.value < 300) {
      stitchGif.src = moods.enerve;
    } else if (gauges.douche.value < 300 && Math.random() < 0.1) {
      stitchGif.src = moods.froid[Math.floor(Math.random() * 2)];
    } else {
      stitchGif.src = moods.normal;
    }
  }

  function playGif(action) {
    const list = gifActions[action];
    const selected = list[Math.floor(Math.random() * list.length)];
    stitchGif.src = selected;

    setTimeout(() => {
      updateMood();
    }, getGifDuration(selected));

    // Remonter la jauge correspondante
    if (gauges[action]) {
      gauges[action].value = Math.min(1000, gauges[action].value + 300);
      updateGauges();
      saveGauges();
    }
  }

  function getGifDuration(name) {
    const long = ["stitch20.gif", "stitch21.gif", "stitch22.gif"];
    if (long.includes(name)) return 6000;
    return 4000;
  }

  setInterval(lowerGauges, 10000); // baisse toutes les 10 secondes

  function togglePage() {
    if (window.location.pathname.includes("tamagotchi")) {
      stitchGif.src = "stitch24.gif";
      setTimeout(() => window.location.href = "index.html", 1000);
    } else {
      stitchGif.src = "stitch25.gif";
      setTimeout(() => window.location.href = "tamagotchi.html", 1000);
    }
  }

  loadGauges();
  updateMood();
</script>

</body>
</html>
